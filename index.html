<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zen Student Clock + Pomodoro</title>
    <style>
        /* ========== THEME VARIABLES ========== */
        :root {
            /* Default: Zen Green */
            --bg-color: #e8f5e9; /* Light Green */
            --text-main: #1b5e20; /* Dark Green */
            --text-faint: #a5d6a7;
            --accent: #2e7d32;

            --glass-bg: rgba(255,255,255,0.6);
            --glass-border: rgba(255,255,255,0.3);

            --overlay-start: rgba(232, 245, 233, 0.8);
        }

        /* Calm Blue â€“ reading / late study */
        [data-theme="blue"] {
            --bg-color: #e3f2fd;
            --text-main: #0d47a1;
            --text-faint: #90caf9;
            --accent: #1976d2;

            --glass-bg: rgba(255,255,255,0.7);
            --glass-border: rgba(255,255,255,0.3);

            --overlay-start: rgba(227, 242, 253, 0.85);
        }

        /* Paper Beige â€“ exam / writing */
        [data-theme="beige"] {
            --bg-color: #fdf6e3;
            --text-main: #5d4037;
            --text-faint: #d7ccc8;
            --accent: #8d6e63;

            --glass-bg: rgba(255,255,255,0.85);
            --glass-border: rgba(0,0,0,0.04);

            --overlay-start: rgba(253, 246, 227, 0.9);
        }

        /* Slate Grey â€“ neutral, zero distraction */
        [data-theme="slate"] {
            --bg-color: #eceff1;
            --text-main: #263238;
            --text-faint: #b0bec5;
            --accent: #455a64;

            --glass-bg: rgba(255,255,255,0.7);
            --glass-border: rgba(0,0,0,0.04);

            --overlay-start: rgba(236, 239, 241, 0.8);
        }

        /* ========== DARK MODE ========== */
        [data-theme="dark"] {
            --bg-color: #0f172a;
            --text-main: #e5e7eb;
            --text-faint: #64748b;
            --accent: #38bdf8;

            --glass-bg: rgba(30,41,59,0.6);
            --glass-border: rgba(255,255,255,0.06);

            --overlay-start: rgba(15, 23, 42, 0.7);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, Roboto, sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: background 0.3s, color 0.3s;
        }

        /* --- THE CLOCK (Always Visible) --- */
        .clock-container {
            z-index: 1;
            text-align: center;
            width: 100%;
            display: flex;
            flex-direction: column; /* Stack clock and status text */
            justify-content: center;
            align-items: center;
            cursor: default;
        }

        .time-display {
            font-size: 18vw;
            font-weight: 600;
            font-variant-numeric: tabular-nums;
            line-height: 1;
            letter-spacing: -5px;
            transition: all 0.3s ease;
            text-shadow: 0 4px 10px rgba(0,0,0,0.05);
            /* Centering fix */
            margin-left: -2vw;
        }

        .seconds-display {
            font-size: 0.4em;
            opacity: 0.6;
            margin-left: 10px;
            font-weight: 300;
            display: inline-block;
        }

        .seconds-display.hidden-visually {
            opacity: 0;
            width: 0;
            overflow: hidden;
            margin: 0;
        }

        /* Status text below clock (e.g. "Focus Time") */
        #clockStatus {
            font-size: 2vw;
            font-weight: 500;
            opacity: 0.7;
            margin-top: -10px;
            min-height: 3vw;
        }

        /* --- THE UI OVERLAY (Fades Out) --- */
        .ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 40px;
            transition: opacity 0.5s ease-in-out;
        }

        .ui-layer.faded {
            opacity: 0;
            pointer-events: none; /* Click through when hidden */
        }
        .ui-layer:not(.faded) {
            background: radial-gradient(circle at center, var(--overlay-start) 0%, transparent 70%);
        }

        /* --- Top Navigation --- */
        .tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .tab-btn {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            padding: 10px 20px;
            font-size: 1rem;
            cursor: pointer;
            border-radius: 30px;
            color: var(--text-main);
            font-weight: 500;
            transition: all 0.2s;
            backdrop-filter: blur(5px);
        }

        .tab-btn:hover {
            filter: brightness(1.05);
            transform: translateY(-2px);
        }

        .tab-btn.active {
            background-color: var(--text-main);
            color: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.12);
        }

        /* --- Center Controls --- */
        .controls-area {
            position: absolute;
            top: 70%;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            width: 100%;
            max-width: 600px;
        }

        .input-group {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            padding: 10px 25px;
            border-radius: 50px;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        }

        .label-text {
            font-size: 0.9rem;
            font-weight: 600;
            margin-right: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-main);
        }

        input {
            background: transparent;
            border: none;
            font-size: 1.5rem;
            color: var(--text-main);
            width: 50px;
            text-align: center;
            font-weight: bold;
            border-bottom: 2px solid transparent;
        }
        input:focus {
            outline: none;
            border-bottom: 2px solid var(--text-main);
        }

        /* Hide arrows on number input */
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
        }

        button.action-btn {
            padding: 15px 40px;
            font-size: 1.1rem;
            border: none;
            background: var(--text-main);
            color: white;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(0,0,0,0.12);
            transition: transform 0.2s, background 0.2s;
        }

        button.action-btn:hover {
            transform: scale(1.05);
            filter: brightness(0.95);
        }

        button.secondary {
            background: var(--glass-bg);
            color: var(--text-main);
            border: 1px solid var(--glass-border);
        }
        button.secondary:hover {
            background: var(--glass-bg);
            filter: brightness(1.03);
        }

        /* --- Bottom Options --- */
        .bottom-bar {
            display: flex;
            justify-content: center;
            gap: 16px;
            font-size: 0.9rem;
            opacity: 0.9;
            align-items: center;
            flex-wrap: wrap;
        }

        .toggle-label {
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-main);
        }

        /* Theme selector */
        select#themeSelector {
            padding: 6px 12px;
            border-radius: 20px;
            border: none;
            font-size: 0.85rem;
            background: var(--glass-bg);
            color: var(--text-main);
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.06);
            border: 1px solid var(--glass-border);
        }

        /* --- Helper Classes --- */
        .mode-ui { display: none; }
        .mode-ui.active { display: flex; flex-direction: column; align-items: center; width: 100%; }

        /* Fullscreen tweak */
        body.fullscreen-mode .clock-container { margin-top: 0; }
    </style>
</head>
<body>

    <div class="clock-container">
        <div class="time-display" id="mainDisplay">
            00:25<span class="seconds-display" id="secSpan">:00</span>
        </div>
        <div id="clockStatus"></div>
    </div>

    <div class="ui-layer" id="uiLayer">

        <div class="tabs">
            <button class="tab-btn active" onclick="switchMode('timer')">Timer</button>
            <button class="tab-btn" onclick="switchMode('pomodoro')">Pomodoro</button>
            <button class="tab-btn" onclick="switchMode('stopwatch')">Stopwatch</button>
            <button class="tab-btn" onclick="switchMode('until')">Deadline</button>
        </div>

        <div class="controls-area">

            <div id="timer-ui" class="mode-ui active">
                <div class="input-group" id="timerInputs">
                    <span class="label-text">H:</span><input type="number" id="t-h" placeholder="00" value="00">
                    <span class="label-text">M:</span><input type="number" id="t-m" placeholder="25" value="25">
                    <span class="label-text">S:</span><input type="number" id="t-s" placeholder="00" value="00">
                </div>
                <div class="action-buttons">
                    <button class="action-btn" id="timerStartBtn" onclick="startTimer()">Start Timer</button>
                    <button class="action-btn secondary" onclick="resetTimer()">Reset</button>
                </div>
            </div>

            <div id="pomodoro-ui" class="mode-ui">
                <div class="input-group" id="pomoInputs">
                    <span class="label-text">Focus (min):</span>
                    <input type="number" id="pomo-focus" value="25">
                    <span style="color:#aaa; margin:0 10px;">|</span>
                    <span class="label-text">Break (min):</span>
                    <input type="number" id="pomo-break" value="5">
                </div>
                <div class="action-buttons">
                    <button class="action-btn" id="pomoStartBtn" onclick="startPomodoro()">Start Cycle</button>
                    <button class="action-btn secondary" onclick="resetPomodoro()">Stop</button>
                </div>
                <p style="margin-top:10px; font-size:0.8rem; opacity:0.7;">Notifications & Audio enabled</p>
            </div>

            <div id="stopwatch-ui" class="mode-ui">
                <div class="action-buttons">
                    <button class="action-btn" id="swStartBtn" onclick="toggleStopwatch()">Start Stopwatch</button>
                    <button class="action-btn secondary" onclick="resetStopwatch()">Reset</button>
                </div>
            </div>

            <div id="until-ui" class="mode-ui">
                <div class="input-group" id="untilInputGroup">
                    <input type="time" id="targetTimeInput" style="width:auto; font-size:1.2rem;">
                </div>
                <div class="action-buttons">
                    <button class="action-btn" onclick="startUntil()">Set Target</button>
                </div>
            </div>

        </div>

        <div class="bottom-bar">
            <label class="toggle-label">
                <input type="checkbox" id="chkSeconds" checked onchange="toggleSeconds()">
                Show Seconds
            </label>
            <label class="toggle-label">
                <input type="checkbox" onchange="toggleFullscreen()">
                Full Screen
            </label>

            <!-- Theme selector (student-focused palettes + dark mode) -->
            <select id="themeSelector" onchange="setTheme(this.value)">
                <option value="default">Zen Green</option>
                <option value="blue">Calm Blue</option>
                <option value="beige">Paper Beige</option>
                <option value="slate">Slate Grey</option>
                <option value="dark">Dark Mode</option>
            </select>
        </div>

    </div>

    <script>
        // --- UI & AUTO HIDE ---
        const uiLayer = document.getElementById('uiLayer');
        let idleTimer;

        function showUI() {
            uiLayer.classList.remove('faded');
            resetIdleTimer();
        }

        function resetIdleTimer() {
            clearTimeout(idleTimer);
            idleTimer = setTimeout(() => {
                uiLayer.classList.add('faded');
            }, 3000);
        }

        ['mousemove', 'click', 'keydown', 'touchstart'].forEach(evt =>
            document.addEventListener(evt, showUI)
        );
        resetIdleTimer();

        // --- NOTIFICATION & SOUND SYSTEM ---

        // 1. Request Permission
        function requestNotifyPermission() {
            if ("Notification" in window && Notification.permission !== "granted") {
                Notification.requestPermission();
            }
        }

        // 2. Play Sound (Web Audio API - No external files)
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playChime() {
            if (audioCtx.state === 'suspended') audioCtx.resume();

            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();

            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(440, audioCtx.currentTime); // A4
            oscillator.frequency.exponentialRampToValueAtTime(880, audioCtx.currentTime + 0.1);

            gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);

            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 0.5);
        }

        // 3. Send Notification
        function sendNotification(title, body) {
            playChime();
            if ("Notification" in window && Notification.permission === "granted") {
                new Notification(title, { body: body, icon: '' });
            } else {
                // Fallback if permission denied
                alert(title + "\n" + body);
            }
        }

        // --- CORE CLOCK LOGIC ---
        let interval = null;
        let mode = 'timer';
        const mainDisplay = document.getElementById('mainDisplay');
        const secSpan = document.getElementById('secSpan');
        const statusDisplay = document.getElementById('clockStatus');

        function updateDisplay(h, m, s) {
            const hh = h < 10 ? '0'+h : h;
            const mm = m < 10 ? '0'+m : m;
            const ss = s < 10 ? '0'+s : s;
            mainDisplay.childNodes[0].nodeValue = `${hh}:${mm}`;
            secSpan.innerText = `:${ss}`;
        }

        function formatTotalSeconds(totalSec) {
            const h = Math.floor(totalSec / 3600);
            const m = Math.floor((totalSec % 3600) / 60);
            const s = Math.floor(totalSec % 60);
            updateDisplay(h, m, s);
        }

        function switchMode(newMode) {
            clearInterval(interval);
            mode = newMode;
            statusDisplay.innerText = ""; // Clear status

            // UI Toggles
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            const tabs = ['timer', 'pomodoro', 'stopwatch', 'until'];
            document.querySelectorAll('.tab-btn')[tabs.indexOf(newMode)].classList.add('active');

            document.querySelectorAll('.mode-ui').forEach(u => u.classList.remove('active'));
            document.getElementById(`${newMode}-ui`).classList.add('active');

            // Reset Logic
            if(mode === 'timer') resetTimer();
            if(mode === 'stopwatch') resetStopwatch();
            if(mode === 'pomodoro') resetPomodoro();
            if(mode === 'until') {
                updateDisplay(0,0,0);
                mainDisplay.childNodes[0].nodeValue = "--:--";
                secSpan.innerText = ":--";
                statusDisplay.innerText = "When is your deadline?";
            }
        }

        // --- POMODORO LOGIC ---
        let pomoState = 'idle'; // idle, focus, break
        let pomoEndTime = 0;

        function startPomodoro() {
            requestNotifyPermission(); // Ask for permission on first click

            const focusMin = parseInt(document.getElementById('pomo-focus').value) || 25;
            const breakMin = parseInt(document.getElementById('pomo-break').value) || 5;

            // Initialize Focus Phase
            if (pomoState === 'idle') {
                pomoState = 'focus';
                const totalSec = focusMin * 60;
                pomoEndTime = Date.now() + (totalSec * 1000);
                document.getElementById('pomoInputs').style.display = 'none';
                document.getElementById('pomoStartBtn').style.display = 'none'; // Only Stop button visible
            }

            statusDisplay.innerText = pomoState === 'focus' ? "Focus Session" : "Break Time";

            clearInterval(interval);
            interval = setInterval(() => {
                const now = Date.now();
                const diff = Math.ceil((pomoEndTime - now) / 1000);

                if (diff <= 0) {
                    // Phase Ended
                    if (pomoState === 'focus') {
                        // Switch to Break
                        sendNotification("Great Job!", "Time for a " + breakMin + " min break.");
                        pomoState = 'break';
                        pomoEndTime = Date.now() + (breakMin * 60 * 1000);
                        statusDisplay.innerText = "Break Time â˜•";
                    } else {
                        // Switch back to Focus
                        sendNotification("Break Over", "Let's get back to work!");
                        pomoState = 'focus';
                        pomoEndTime = Date.now() + (focusMin * 60 * 1000);
                        statusDisplay.innerText = "Focus Session ðŸ§ ";
                    }
                } else {
                    formatTotalSeconds(diff);
                }
            }, 100);
        }

        function resetPomodoro() {
            clearInterval(interval);
            pomoState = 'idle';
            document.getElementById('pomoInputs').style.display = 'flex';
            document.getElementById('pomoStartBtn').style.display = 'block';
            statusDisplay.innerText = "";
            const focusMin = parseInt(document.getElementById('pomo-focus').value) || 25;
            updateDisplay(0, focusMin, 0);
        }

        // --- TIMER LOGIC ---
        let timerEndTimestamp = 0;
        let isTimerRunning = false;

        function startTimer() {
            if(isTimerRunning) { // Pause
                isTimerRunning = false;
                clearInterval(interval);
                document.getElementById('timerStartBtn').innerText = "Resume";
                return;
            }

            // Start/Resume
            const h = parseInt(document.getElementById('t-h').value) || 0;
            const m = parseInt(document.getElementById('t-m').value) || 0;
            const s = parseInt(document.getElementById('t-s').value) || 0;

            if (!timerEndTimestamp) {
                const totalSec = (h * 3600) + (m * 60) + s;
                if(totalSec <= 0) return;
                timerEndTimestamp = Date.now() + (totalSec * 1000);
            } else {
                 // Simple resume logic for this demo (recalculating target would require tracking remaining)
                 // For now, let's just reset target based on input for simplicity or stick to simple pause
                 // Proper pause requires holding 'remaining' var.
                 // Re-calculating for UX simplicity:
                 const totalSec = (h * 3600) + (m * 60) + s;
                 timerEndTimestamp = Date.now() + (totalSec * 1000);
            }

            isTimerRunning = true;
            document.getElementById('timerStartBtn').innerText = "Pause";
            document.getElementById('timerInputs').style.display = 'none';
            statusDisplay.innerText = "Timer Running";

            interval = setInterval(() => {
                const diff = Math.ceil((timerEndTimestamp - Date.now()) / 1000);
                if (diff <= 0) {
                    clearInterval(interval);
                    isTimerRunning = false;
                    formatTotalSeconds(0);
                    sendNotification("Timer Done", "Your timer has finished.");
                    resetTimer();
                } else {
                    formatTotalSeconds(diff);
                }
            }, 100);
        }

        function resetTimer() {
            clearInterval(interval);
            isTimerRunning = false;
            timerEndTimestamp = 0;
            document.getElementById('timerStartBtn').innerText = "Start Timer";
            document.getElementById('timerInputs').style.display = 'flex';
            statusDisplay.innerText = "";
            updateDisplay(0, parseInt(document.getElementById('t-m').value)||0, 0);
        }

        // --- STOPWATCH LOGIC ---
        let swStart = 0;
        let swElapsed = 0;
        let swRunning = false;

        function toggleStopwatch() {
            if(swRunning) {
                swRunning = false;
                clearInterval(interval);
                swElapsed = Date.now() - swStart;
                document.getElementById('swStartBtn').innerText = "Resume";
            } else {
                swRunning = true;
                swStart = Date.now() - swElapsed;
                document.getElementById('swStartBtn').innerText = "Pause";
                statusDisplay.innerText = "Stopwatch";
                interval = setInterval(() => {
                    formatTotalSeconds(Math.floor((Date.now() - swStart)/1000));
                }, 100);
            }
        }

        function resetStopwatch() {
            swRunning = false;
            clearInterval(interval);
            swElapsed = 0;
            formatTotalSeconds(0);
            document.getElementById('swStartBtn').innerText = "Start Stopwatch";
            statusDisplay.innerText = "";
        }

        // --- DEADLINE LOGIC ---
        function startUntil() {
            const input = document.getElementById('targetTimeInput').value;
            if(!input) return;
            clearInterval(interval);

            const now = new Date();
            const [th, tm] = input.split(':').map(Number);
            let target = new Date();
            target.setHours(th, tm, 0, 0);
            if(target < now) target.setDate(target.getDate() + 1);

            document.getElementById('untilInputGroup').style.display = 'none';
            statusDisplay.innerText = `Deadline: ${input}`;

            interval = setInterval(() => {
                const diff = Math.ceil((target - Date.now()) / 1000);
                if(diff <= 0) {
                    clearInterval(interval);
                    formatTotalSeconds(0);
                    statusDisplay.innerText = "Deadline Reached";
                    sendNotification("Deadline Reached", "You made it!");
                } else {
                    formatTotalSeconds(diff);
                }
            }, 100);
        }

        // --- OPTIONS ---
        function toggleSeconds() {
            const chk = document.getElementById('chkSeconds');
            if(chk.checked) secSpan.classList.remove('hidden-visually');
            else secSpan.classList.add('hidden-visually');
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
                document.body.classList.add('fullscreen-mode');
            } else {
                if(document.exitFullscreen) {
                    document.exitFullscreen();
                    document.body.classList.remove('fullscreen-mode');
                }
            }
        }

        // ========== THEME SWITCHER (persistence, no logic changes to core) ==========
        const docRoot = document.documentElement;
        const themeSelect = document.getElementById('themeSelector');

        function setTheme(theme) {
            if (!theme || theme === 'default') {
                docRoot.removeAttribute('data-theme');
            } else {
                docRoot.setAttribute('data-theme', theme);
            }
            try {
                localStorage.setItem('zenTheme', theme);
            } catch (e) {
                // ignore storage errors silently
            }
        }

        (function loadSavedTheme() {
            try {
                const saved = localStorage.getItem('zenTheme');
                if (saved) {
                    if (saved === 'default') {
                        docRoot.removeAttribute('data-theme');
                        themeSelect.value = 'default';
                    } else {
                        docRoot.setAttribute('data-theme', saved);
                        themeSelect.value = saved;
                    }
                } else {
                    themeSelect.value = 'default';
                }
            } catch (e) {
                themeSelect.value = 'default';
            }
        })();
    </script>
</body>
</html>
